<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>home</title>
    <script src="http://libs.useso.com/js/jquery/2.1.1/jquery.min.js" charset="utf-8"></script>

    <script charset="utf-8">
        function consvr(){
          $.ajax({
            url: "http://127.0.0.1:8080/getnsq/",
            type: 'GET',
            data: {contype:"start"},
            success: function (data) {
              alert(data);
            }
        });
      }


function getNsqMsg(){
  var nsq = require('nsq.js');

// subscribe

var reader = nsq.reader({
  nsqd: [':4150'],
  maxInFlight: 1,
  maxAttempts: 5,
  topic: 'events',
  channel: 'ingestion'
});

reader.on('error', function(err){
  console.log(err.stack);
});

reader.on('message', function(msg){
  var body = msg.body.toString();
  console.log('%s attempts=%s', body, msg.attempts);
  msg.requeue(2000);
});

reader.on('discard', function(msg){
  var body = msg.body.toString();
  console.log('giving up on %s', body);
  msg.finish();
});

// publish

var writer = nsq.writer(':4150');

writer.on('ready', function() {
  writer.publish('events', 'foo');
  writer.publish('events', 'bar');
  writer.publish('events', 'baz');
});
}


    </script>



  </head>
  <body>
    这是一个测试页面，用来测试nsq的功能。<br />
    <input type="button" name="name" value="连接服务器" onclick="consvr()">
    <input type="button" name="name" value="断开服务器">
  </body>
</html>
