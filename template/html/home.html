<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>home</title>
    <!-- <script src="http://libs.useso.com/js/jquery/2.1.1/jquery.min.js" charset="utf-8"></script> -->
    <script src="js/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>
    <script src="js/react/0.13.0/react.js"></script>
    <script src="js/react/0.13.0/JSXTransformer.js"></script>
    
    <script charset="utf-8">
      $(function () {
         //setInterval("BindHtml.receiveMsg()", 10000);//1000为1秒钟
      }); 
      
      
      
      var BindHtml = {
          init: function () {
          }, 
          sendMsgNsq: function () {

              var msg = $("#iptCon").val();
              $.ajax({
                  url: "http://nsq-ttthzygi35.tenxcloud.net:20157/put?topic=test",
                  type: 'POST',
                  data: msg,
                  success: function (data) { },
                  error: function (data) {
                      alert("消息推送完毕！");
                  },
              });
          },
          sendMsgLocal: function () {
              var msg = $("#iptCon").val();
              $.ajax({
                  url: "/SendMsg/",
                  type: 'GET',
                  data: {
                      sendmsg: msg
                  },
                  success: function (data) {
                      alert(data);
                  },
                  error: function (data) {
                      alert(data);
                  },
              });
          },
          receiveMsg: function () {
              $.ajax({
                  url: "/ReceiveMsg/",
                  type: 'GET',
                  data: {
                      topic: "test",
                      limit: 1
                  },
                  success: function (data) {
                      var jsondata = JSON.parse(data);

                      for (var i = 0; i < jsondata.length; i++) {
                          var li = $("#ul_msg li[id='mli" + jsondata[i].Id + "']").val();
                          if (typeof (li) == "undefined") {
                              $("#ul_msg").append("<li id='mli" + jsondata[i].Id + "'>" + jsondata[i].Message + "</li>");
                          }
                      }
                  },
                  error: function (data) {
                      alert(data);
                  },
              });
          }
      }


    </script>

</head>
<body>
    <div>
        这是一个测试页面，用来测试nsq的功能。
        <br />
        <input type="text" id="iptCon" name="iptCon" value="" />
        <input type="button" id="iptBtn" name="iptBtn" value="直推NSQ服务器" onclick="BindHtml.sendMsgNsq()" />
        <input type="button" id="iptBtn" name="iptBtn" value="后台推NSQ" onclick="BindHtml.sendMsgLocal()" />

        <input type="button" id="iptBtn2" name="iptBtn2" value="拉取NSQ消息" onclick="BindHtml.receiveMsg()" />


    </div>

    <div>
        <ul id="ul_msg">
  
        </ul>
    </div>
    
    
    <div id="example"></div>
    <script type="text/jsx">
      var WithLink = React.createClass({
  mixins: [React.addons.LinkedStateMixin],
  getInitialState: function() {
    return {message: 'Hello!'};
  },
  render: function() {
    return <input type="text" valueLink={this.linkState('message')} />;
  }
});

React.render(
  <WithLink />,
  document.getElementById('example')
);
      
      
    </script>

</body>

</html>